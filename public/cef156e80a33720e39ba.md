---
title: Qiita Organizationãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ç¤¾å†…ã®ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«é€šçŸ¥ã™ã‚‹GASã‚’ä½œã£ã¦ã¿ãŸ
tags:
  - GoogleAppsScript
  - GAS
  - Chatwork
private: false
updated_at: '2021-11-22T20:29:48+09:00'
id: cef156e80a33720e39ba
organization_url_name: null
slide: false
ignorePublish: false
---
Qiita Organizationãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ChatWorkã«é€šçŸ¥ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸ:muscle:

[ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é¢¨ã«ã‚«ã‚¹ã‚¿ãƒ ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸ](https://qiita.com/tanaka-kazuki/items/9c41a0e4ce7d395dc9f2)

## ã‚„ã£ãŸã“ã¨

```
/**
 * @summary ChatWorkã«é€šçŸ¥ã—ã¾ã™
 */
function main() {
  let msg = qiitaOrgGet()
  sendChatwork(msg)
}

/**
 * qiitaã€€organizationã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã¨æ–‡å­—åˆ—ã®æ•´å½¢ã‚’è¡Œã†
 */
function qiitaOrgGet() {

  //ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°URL é€±é–“ãƒ»æœˆé–“
  let url = [
    'https://qiita.com/organizations?sort=default',
    'https://qiita.com/organizations?sort=activity_stats_total'
  ]

  //organizationURLé€£çµç”¨
  let orgurl = 'https://qiita.com/organizations/'

  //organizationåå–å¾—ç”¨ãƒ‘ãƒ¼ã‚¹æ–‡å­—
  let from1 = '<strong class="ol-Item_name" itemprop="name"><a href='
  let to1 = '</a></strong><p class="ol-Item_description" itemprop="description">'

  //æŠ•ç¨¿æ•°å–å¾—ç”¨ãƒ‘ãƒ¼ã‚¹æ–‡å­—
  let from2 = '<div class="ol-Item_postNum mr-1of2">'
  let to2 = '</div>'

  //orgnizatonæƒ…å ±æ ¼ç´ç”¨
  let orglist = [[''], ['']]

  //emojiå¤‰æ›ç”¨
  let emoji = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', '4', '5']

  //ChatWorkç”¨
  let msg = '*Qiita OrganizationæŠ•ç¨¿ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒã‚§ãƒƒã‚«ãƒ¼*' + String.fromCharCode(10) + 'é †ä½ã€æŠ•ç¨¿æ•°ã€Organizationå' + String.fromCharCode(10)

  //ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°&ãƒ‡ãƒ¼ã‚¿åŠ å·¥
  for (let i in url) {
    let html = UrlFetchApp.fetch(url[i]).getContentText()
    let name = Parser(html, from1, to1)
    let postCnt = Parser(html, from2, to2)

    //äº‹å¾Œå‡¦ç†
    for (let j in name) {
      orglist[i].push([i
        , name[j].slice(name[j].indexOf('>') + 1)
        , orgurl + name[j].slice(name[j].indexOf('s/') + 2
          , name[j].indexOf('>') - 1)
        , postCnt[j]])
    }
  }

  //ChatWorkç”¨ã«MSGæ•´å½¢
  for (let i in orglist) {
    for (let j = 1; j <= 5; j++) {

      if (i == 0 && j == 1) {
        msg = msg + '  _*é€±é–“ãƒ©ãƒ³ã‚­ãƒ³ã‚°*_' + String.fromCharCode(10)
      } else if (i == 1 && j == 1) {
        msg = msg + String.fromCharCode(10) + '  *æœˆé–“ãƒ©ãƒ³ã‚­ãƒ³ã‚°*' + String.fromCharCode(10)
      }


      Logger.log(emoji[j - 1])

      msg = msg + 'é †ä½' + emoji[j - 1] + '  ' + 'æŠ•ç¨¿æ•°' + orglist[i][j][3] + '  ' + orglist[i][j][1] + '  ' + orglist[i][j][2] + '  ' + String.fromCharCode(10)
    }
  }
  Logger.log(msg)
  return msg
}

//ç›´å‰(from)ã€ç›´å¾Œ(to)ã®æ–‡å­—åˆ—ã§å›²ã‚ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã€‚
function Parser(data, from, to) {

  /*
  data ãƒ»ãƒ» ãƒ‘ãƒ¼ã‚¹å¯¾è±¡ã®æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
  from ãƒ»ãƒ» ãƒ‘ãƒ¼ã‚¹å¯¾è±¡ã®æ–‡å­—åˆ—ã®ç›´å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®š
  to   ãƒ»ãƒ» ãƒ‘ãƒ¼ã‚¹å¯¾è±¡ã®æ–‡å­—åˆ—ã®ç›´å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®š
  from,toã§å›²ã‚ã‚ŒãŸæ–‡å­—ã‚’å…¨ã¦æ¤œç´¢ã—ã¦é…åˆ—ã«æ ¼ç´ã—ã¾ã™ã€‚
  */

  //åˆæœŸå€¤
  let tmp = []
  let tmpindex
  let fromindex = data.indexOf(from)
  let toindex = data.indexOf(to)

  if (fromindex != -1) {
    for (let i = 0; i <= data.length; i++) {

      //å¾Œç¶šã‚ã‚‹ãªã—åˆ¤å®š
      if (toindex == -1 || fromindex == -1)
        break;


      //from < to ãªã‚‰ä»£å…¥
      if (fromindex + from.length < toindex) {
        tmp.push(data.slice(fromindex + from.length, toindex))
      }

      tmpindex = toindex

      //å¾Œç¶šindexã‚µãƒ¼ãƒ
      fromindex = data.indexOf(from, tmpindex)
      toindex = data.indexOf(to, tmpindex + 1)
    }
  }
  return tmp
}

//ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸MSGé€ä¿¡(ChatWorkClient)
function sendChatwork(ToChatWorkMsg) {

  //ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®é€šçŸ¥è¨­å®š
  let client = ChatWorkClient.factory({ token: "xxxxx" });

  client.sendMessage({
    room_id: xxxxxx,
    body: "[info][title]Qiita OrganizationæŠ•ç¨¿ãƒ©ãƒ³ã‚­ãƒ³ã‚°[/title]\n" + ToChatWorkMsg + "[/info]"
  });
}

```


## è§£èª¬

:::note info
Qiitaã®organizationsãƒšãƒ¼ã‚¸ã§é€±é–“ãƒ»æœˆé–“ã‚’åˆ‡ã‚Šæ›¿ãˆãŸã¨ãã«å–å¾—ã§ãã‚‹Paramã‚’è¨­å®šã—ã¾ã™
é€±é–“ï¼š?sort=default
æœˆé–“ï¼š?sort=activity_stats_total
:::
```
  //ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°URL é€±é–“ãƒ»æœˆé–“
  let url = [
    'https://qiita.com/organizations?sort=default',
    'https://qiita.com/organizations?sort=activity_stats_total'
  ]
```

:::note info
ChatWorkã®ãƒ¦ãƒ¼ã‚¶ãƒ¼Tokenã‚’tokenã«æŒ‡å®šã—ã¦ãã ã•ã„
é€šçŸ¥ã™ã‚‹ãƒ«ãƒ¼ãƒ IDã‚’room_idã«æŒ‡å®šã—ã¦ãã ã•ã„
:::
```
  //ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®é€šçŸ¥è¨­å®š
  let client = ChatWorkClient.factory({ token: "xxxxx" });

  client.sendMessage({
    room_id: xxxxx,
    body: "[info][title]Qiita OrganizationæŠ•ç¨¿ãƒ©ãƒ³ã‚­ãƒ³ã‚°[/title]\n" + ToChatWorkMsg + "[/info]"
  });
```

:::note warn
ChatWorkClientãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¦ãã ã•ã„
:::
[ã‚¹ã‚¯ãƒªãƒ—ãƒˆIDã¯ã“ã¡ã‚‰](https://github.com/cw-shibuya/chatwork-client-gas)

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-19 4.31.17.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/05e28b30-1dd7-eb8f-093c-dd58ae5d4e55.png)

:::note info
GASã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’é€šçŸ¥ã—ã¦ãã‚Œã¾ã™ï¼
:::
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2021-11-19 4.29.50.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555632/2334df14-e4bc-93b3-3fa5-3b63e2432860.png)

## æœ€å¾Œã«

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
ä»Šå›ã®è¨˜äº‹ã¯ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ
ãƒ»ã“ã†ã„ã†è¨˜äº‹ãŒèª­ã¿ãŸã„
ãƒ»ã“ã†ã„ã†ã¨ã“ã‚ãŒè‰¯ã‹ã£ãŸ
ãƒ»ã“ã†ã—ãŸæ–¹ãŒè‰¯ã„ã®ã§ã¯ãªã„ã‹
ãªã©ãªã©ã€ç‡ç›´ãªã”æ„è¦‹ã‚’å‹Ÿé›†ã—ã¦ãŠã‚Šã¾ã™ã€‚
